<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>iBuildpro | Alpha Terminal v13</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@500;800&family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet">
    <style>
        :root { --gs-blue: #38bdf8; --gs-emerald: #10b981; --gs-red: #f43f5e; --gs-border: #1e293b; }
        body { background: #000; font-family: 'Inter', sans-serif; color: #f8fafc; }
        .gs-card { background: #080808; border: 1px solid var(--gs-border); border-radius: 4px; }
        .accounting-input { background: #000; border: 1px solid #333; padding: 16px; width: 100%; color: var(--gs-blue); font-family: 'JetBrains Mono'; font-size: 22px; text-align: right; outline: none; border-radius: 4px; }
        .accounting-input:focus { border-color: var(--gs-blue); background: #020617; }
        .label-gs { font-size: 9px; font-weight: 800; color: #444; text-transform: uppercase; letter-spacing: 0.2em; border-bottom: 1px solid #111; padding-bottom: 4px; margin-bottom: 10px; display: block; }
        .mono { font-family: 'JetBrains Mono', monospace; }
        .accretion { border-left: 4px solid var(--gs-blue); background: linear-gradient(90deg, rgba(56, 189, 248, 0.03) 0%, transparent 100%); }
        .attrition { border-left: 4px solid var(--gs-red); background: linear-gradient(90deg, rgba(244, 63, 94, 0.03) 0%, transparent 100%); }
        .cap-indicator { font-size: 10px; font-weight: bold; color: #64748b; margin-top: 6px; display: block; }
    </style>
</head>
<body class="p-4 md:p-10 max-w-2xl mx-auto pb-32">

    <header class="flex justify-between items-start mb-10 border-b border-white/5 pb-8">
        <div>
            <h1 class="text-2xl font-black tracking-tighter text-white uppercase italic leading-none">Stockbridge <span class="text-slate-700 font-light italic text-sm">v13.0</span></h1>
            <p class="mono text-[10px] text-blue-500 font-bold uppercase tracking-widest mt-2">Capped Tranche Modeler</p>
        </div>
        <div class="text-right">
            <p class="mono text-[11px] text-slate-500 font-bold uppercase mb-1">Terminal Value (B5)</p>
            <p class="text-4xl font-black text-white tracking-tighter" id="top-val">£38.38M</p>
        </div>
    </header>

    <section class="grid grid-cols-2 gap-4 mb-8">
        <div class="gs-card p-5 accretion">
            <span class="label-gs">Terminal Stake</span>
            <p class="text-2xl font-black mono text-white" id="stat-adj-own">2.93%</p>
            <p class="text-[10px] text-slate-500 mono mt-2 font-bold">BASELINE: 2.93%</p>
        </div>
        <div class="gs-card p-5">
            <span class="label-gs">Efficiency ROI</span>
            <p class="text-2xl font-black mono text-emerald-500" id="stat-roi">76.8x</p>
            <p class="text-[10px] text-slate-500 mono mt-2 font-bold uppercase" id="basis-display">COST: £500k</p>
        </div>
    </section>

    <section class="gs-card p-8 mb-8 border-t-2 border-t-blue-500 shadow-2xl shadow-blue-900/10">
        <div class="flex justify-between items-center mb-8">
            <span class="label-gs border-none p-0 m-0 text-slate-300">Tranche Participation Logic</span>
            <button onclick="resetModel()" class="mono text-[10px] font-bold text-slate-600 hover:text-white uppercase transition tracking-widest">Reset Simulation</button>
        </div>
        
        <div class="space-y-10">
            <div>
                <label class="mono text-[11px] text-slate-400 uppercase font-bold italic mb-3 block">Allocated Seed Round</label>
                <div class="relative">
                    <input type="text" id="cash-seed" class="accounting-input" placeholder="£0.00" oninput="formatCurrency(this)">
                </div>
                <div class="flex justify-between items-center mt-2">
                    <span class="cap-indicator">LIMIT: £7,000,000</span>
                    <span class="mono text-[9px] text-blue-500 font-bold" id="seed-share-calc">+0 SHARES</span>
                </div>
            </div>

            <div>
                <label class="mono text-[11px] text-slate-400 uppercase font-bold italic mb-3 block">Allocated Bank Round</label>
                <div class="relative">
                    <input type="text" id="cash-bank" class="accounting-input" placeholder="£0.00" oninput="formatCurrency(this)">
                </div>
                <div class="flex justify-between items-center mt-2">
                    <span class="cap-indicator">LIMIT: £60,000,000</span>
                    <span class="mono text-[9px] text-blue-500 font-bold" id="bank-share-calc">+0 SHARES</span>
                </div>
            </div>
        </div>

        <div class="mt-12 p-6 rounded-lg bg-emerald-500/5 border border-emerald-500/10">
            <div class="flex justify-between items-end mb-4">
                <span class="text-[10px] font-black text-slate-500 uppercase">Incremental Value Capture</span>
                <span class="mono text-xl font-black text-emerald-400" id="res-delta-val">£0.00M</span>
            </div>
            <div class="text-[9px] text-slate-600 mono uppercase">Marginal gain calculated against fixed baseline of 144,092 PS+ shares.</div>
        </div>
    </section>

    <section class="gs-card p-6 mb-10">
        <span class="label-gs border-none p-0 m-0 mb-6">Dilution Step-Function sensitivity</span>
        <div class="h-48">
            <canvas id="gsChart"></canvas>
        </div>
    </section>

    <section class="space-y-3 mb-24">
        <span class="label-gs px-1">Valuation Ledger (Prior vs Adjusted)</span>
        <div id="valuation-ledger" class="space-y-2"></div>
    </section>

    <script>
        const PRIOR_SHARES = 144092;
        const PRIOR_BASIS = 500000;
        const PPS_SEED = 11.68;
        const PPS_BANK = 58.40;
        const CAP_SEED = 7000000;
        const CAP_BANK = 60000000;

        const MODEL_DATA = [
            { r: "PS Plus (Prior)", pps: 3.47, fd: 2825331, type: 'prior' },
            { r: "Seed Round", pps: 11.68, fd: 3424646, type: 'accretion' },
            { r: "Bank Round", pps: 58.40, fd: 4452046, type: 'accretion' },
            { r: "Balance 1", pps: 58.40, fd: 4657571, type: 'attrition' },
            { r: "Balance 2", pps: 96.64, fd: 4761071, type: 'attrition' },
            { r: "Balance 3", pps: 142.77, fd: 4831121, type: 'attrition' },
            { r: "Balance 4", pps: 201.79, fd: 4880661, type: 'attrition' },
            { r: "Balance 5", pps: 266.39, fd: 4918211, type: 'attrition' }
        ];

        let chart;

        function formatCurrency(input) {
            let raw = input.value.replace(/\D/g, "");
            if (raw === "") {
                input.value = "";
                refresh();
                return;
            }
            let n = parseInt(raw) / 100;
            
            // Apply Hard Caps
            if(input.id === 'cash-seed' && n > CAP_SEED) n = CAP_SEED;
            if(input.id === 'cash-bank' && n > CAP_BANK) n = CAP_BANK;

            input.value = n.toLocaleString('en-GB', { 
                style: 'currency', currency: 'GBP', minimumFractionDigits: 2 
            });
            refresh();
        }

        function parseVal(id) {
            let v = document.getElementById(id).value;
            if (!v) return 0;
            return parseFloat(v.replace(/[^\d.]/g, "")) || 0;
        }

        function refresh() {
            const seedCash = parseVal('cash-seed');
            const bankCash = parseVal('cash-bank');
            
            const nSeed = Math.floor(seedCash / PPS_SEED);
            const nBank = Math.floor(bankCash / PPS_BANK);
            
            const totalAtSeed = PRIOR_SHARES + nSeed;
            const terminalTotal = totalAtSeed + nBank;
            const totalBasis = PRIOR_BASIS + seedCash + bankCash;

            const b5 = MODEL_DATA[7];
            const baseVal = PRIOR_SHARES * b5.pps;
            const adjVal = terminalTotal * b5.pps;

            // UI UPDATES
            document.getElementById('top-val').innerText = "£" + (adjVal/1000000).toFixed(2) + "M";
            document.getElementById('stat-adj-own').innerText = ((terminalTotal / b5.fd)*100).toFixed(2) + "%";
            document.getElementById('stat-roi').innerText = (adjVal / totalBasis).toFixed(1) + "x";
            document.getElementById('basis-display').innerText = "COST: £" + (totalBasis/1000).toFixed(0) + "k";
            document.getElementById('seed-share-calc').innerText = "+" + nSeed.toLocaleString() + " SHARES";
            document.getElementById('bank-share-calc').innerText = "+" + nBank.toLocaleString() + " SHARES";
            document.getElementById('res-delta-val').innerText = "£" + ((adjVal - baseVal)/1000000).toFixed(2) + "M";

            const ledger = document.getElementById('valuation-ledger');
            ledger.innerHTML = '';
            MODEL_DATA.forEach((d, i) => {
                let s;
                if(i === 0) s = PRIOR_SHARES;
                else if(i === 1) s = totalAtSeed;
                else s = terminalTotal;

                ledger.innerHTML += `
                    <div class="gs-card p-4 flex justify-between items-center ${d.type}">
                        <div>
                            <p class="mono text-[10px] font-black text-white uppercase">${d.r}</p>
                            <p class="mono text-[8px] text-slate-500 mt-1 uppercase">VALUATION: £${(d.fd * d.pps / 1000000).toFixed(1)}M</p>
                        </div>
                        <div class="text-right">
                            <p class="mono text-sm font-bold text-white">£${(s * d.pps / 1000000).toFixed(2)}M</p>
                            <p class="mono text-[9px] font-bold text-blue-400 uppercase">${((s/d.fd)*100).toFixed(2)}% STAKE</p>
                        </div>
                    </div>
                `;
            });

            chart.data.datasets[1].data = MODEL_DATA.map((d, i) => {
                let s = (i === 0) ? PRIOR_SHARES : (i === 1 ? totalAtSeed : terminalTotal);
                return (s / d.fd) * 100;
            });
            chart.update();
        }

        function resetModel() {
            document.getElementById('cash-seed').value = "";
            document.getElementById('cash-bank').value = "";
            refresh();
        }

        const ctx = document.getElementById('gsChart').getContext('2d');
        chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: MODEL_DATA.map(d => d.r),
                datasets: [
                    { data: MODEL_DATA.map(d => (PRIOR_SHARES/d.fd)*100), borderColor: '#222', borderWidth: 1.5, borderDash: [4, 4], pointRadius: 0, fill: false },
                    { data: [], borderColor: '#38bdf8', borderWidth: 3, pointBackgroundColor: '#fff', tension: 0.1, fill: false }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    x: { grid: { display: false }, ticks: { color: '#444', font: { size: 9, family: 'JetBrains Mono' } } },
                    y: { grid: { color: '#111' }, ticks: { color: '#444', font: { size: 9, family: 'JetBrains Mono' } } }
                }
            }
        });

        refresh();
    </script>
</body>
</html>
